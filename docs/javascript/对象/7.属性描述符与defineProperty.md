---
title: 属性描述符与 defineProperty
createTime: 2026/02/26 18:31:17
permalink: /javascript/j0rc922y/
---

`Object.defineProperty` 的价值不是“多一种赋值写法”，而是让属性具备可控行为：可写、可枚举、可配置、访问拦截。

## 基本语法

```js
Object.defineProperty(obj, key, descriptor)
Object.defineProperties(obj, descriptors)
```

## 数据描述符

可用字段：`value`、`writable`、`enumerable`、`configurable`

```js
const obj = {}

Object.defineProperty(obj, 'a', {
  value: 1,
})

console.log(obj.a) // 1
obj.a = 10
console.log(obj.a) // 1（默认 writable: false）
```

:::note
默认情况下（未显式声明时）：
- `writable: false`
- `enumerable: false`
- `configurable: false`
:::

## 让属性可写、可枚举、可删除

```js
const obj = {}

Object.defineProperty(obj, 'a', {
  value: 1,
  writable: true,
  enumerable: true,
  configurable: true,
})

obj.a = 5
console.log(obj.a) // 5

for (const k in obj) {
  console.log(k) // a
}

delete obj.a
console.log(obj.a) // undefined
```

## 访问器描述符（`get/set`）

可用字段：`get`、`set`、`enumerable`、`configurable`

```js
const obj = {}
let inner = 0

Object.defineProperty(obj, 'count', {
  get() {
    return inner
  },
  set(v) {
    console.log('set =>', v)
    inner = v
  },
  enumerable: true,
  configurable: true,
})

obj.count = 10 // set => 10
console.log(obj.count) // 10
```

:::warning
`value/writable` 不能和 `get/set` 同时出现，否则会抛 `TypeError`。
:::

## 小实战：记录属性历史

```js
function DataHistory() {
  let current = null
  const history = []

  Object.defineProperty(this, 'value', {
    get() {
      return current
    },
    set(v) {
      current = v
      history.push({ value: v, time: Date.now() })
    },
    enumerable: true,
  })

  this.getHistory = function getHistory() {
    return history.slice()
  }
}

const data = new DataHistory()
data.value = 100
data.value = 200

console.log(data.getHistory())
```
