---
title: 路由
createTime: 2026/02/04 22:58:21
permalink: /vue/tbrb96uh/
---

> [!IMPORTANT]
> 本文基于 Nuxt 4（`app/*` 目录结构）
> Nuxt 路由采用 **文件系统路由**：`app/pages` 下的文件自动生成路由

:::details 最佳实践
1. 只在 `app/pages` 写页面，避免手动维护路由表
2. 动态参数务必校验：`definePageMeta({ validate })` 防止非法访问
3. 导航优先用 `NuxtLink`，减少手写 `router.push`
4. 中间件只做“准入判断”，不要做重请求
5. 路由结构保持扁平清晰，过深会降低可读性
:::

## 核心概念

### 基于文件的路由

`app/pages` 中的文件与目录会自动映射为路由：

::: file-tree
- app
  - pages
    - index.vue            /
    - about.vue            /about
    - posts
      - index.vue          /posts
      - [id].vue           /posts/:id
    - docs
      - [...slug].vue      /docs/*
    - [[lang]].vue         /:lang?
    - (marketing)
      - pricing.vue        /pricing
:::

> [!NOTE]
> 如果项目里没有 `app/pages`，Nuxt 不会启用 `vue-router`。

### 动态路由规则

[+动态参数]: 使用 `[]` 包裹，如 `[id].vue` → `:id`  
[+可选参数]: 使用 `[[param]].vue` → `:param?`  
[+捕获所有]: 使用 `[...slug].vue` → `*`  
[+路由分组]: 使用 `(group)` 目录，**不会**出现在 URL 中

### 读取路由参数

```vue
<script setup lang="ts">
const route = useRoute()
// /posts/123 → route.params.id = '123'
console.log(route.params.id)
</script>
```

## 页面导航

### NuxtLink（推荐）

```vue
<template>
  <nav class="flex gap-3">
    <NuxtLink to="/">Home</NuxtLink>
    <NuxtLink to="/about">About</NuxtLink>
    <NuxtLink :to="{ name: 'posts-id', params: { id: 1 } }">Post</NuxtLink>
  </nav>
</template>
```

> [!TIP]
> `NuxtLink` 默认带预取（prefetch），进入可视区时会预加载目标页面。

### 编程式导航

```vue
<script setup lang="ts">
const router = useRouter()

function goToPost(id: number) {
  navigateTo(`/posts/${id}`)
  // 或：
  // router.push({ name: 'posts-id', params: { id } })
}
</script>
```

## 页面元信息（definePageMeta）

在页面中用 `definePageMeta` 声明布局、路由中间件、校验逻辑等：

```vue
<script setup lang="ts">
definePageMeta({
  title: '文章详情',
  layout: 'docs',
  middleware: ['auth'],
  validate: (route) => /^\d+$/.test(route.params.id as string),
})
</script>
```

## 布局（Layouts）

布局文件位于 `app/layouts`，页面可通过 `definePageMeta` 指定布局。

:::code-tabs
@tab app/layouts/default.vue
```vue
<template>
  <div class="layout">
    <header>Header</header>
    <slot />
    <footer>Footer</footer>
  </div>
</template>
```

@tab app/layouts/admin.vue
```vue
<template>
  <div class="admin">
    <aside>Sidebar</aside>
    <main><slot /></main>
  </div>
</template>
```
:::

```vue
<script setup lang="ts">
definePageMeta({
  layout: 'admin',
})
</script>
```

## 路由中间件（简述）

路由中间件用于导航前的准入控制。  
更多细节见「中间件」章节。

```ts
// app/middleware/auth.ts
export default defineNuxtRouteMiddleware(() => {
  const token = useCookie<string | null>('token')
  if (!token.value) return navigateTo('/login')
})
```

## 路由校验（validate）

`validate` 返回 `false` 时会触发 404。  
适合用于校验动态参数是否合法。

```vue
<script setup lang="ts">
definePageMeta({
  validate: (route) => /^\d+$/.test(route.params.id as string),
})
</script>
```

## 示例：文章列表 -> 详情页（带校验）

::::steps

1. 准备页面结构

   ::: file-tree
   - app
     - pages
       - posts
         - index.vue
         - [id].vue
   :::

2. 列表页使用 `NuxtLink`

   :::code-tabs
   @tab app/pages/posts/index.vue
   ```vue
   <script setup lang="ts">
   const list = [
     { id: 1, title: 'Nuxt 路由入门' },
     { id: 2, title: '动态路由实践' },
   ]
   </script>

   <template>
     <ul>
       <li v-for="item in list" :key="item.id">
         <NuxtLink :to="`/posts/${item.id}`">{{ item.title }}</NuxtLink>
       </li>
     </ul>
   </template>
   ```
   :::

3. 详情页读取参数并请求数据

   :::code-tabs
   @tab app/pages/posts/[id].vue
   ```vue
   <script setup lang="ts">
   const route = useRoute()

   const { data } = await useAsyncData(
     () => `post-${route.params.id}`,
     () => $fetch(`/api/posts/${route.params.id}`),
   )
   </script>

   <template>
     <article>
       <h1>{{ data?.title }}</h1>
       <p>{{ data?.content }}</p>
     </article>
   </template>
   ```
   :::

4. 对 `id` 做合法性校验

   :::code-tabs
   @tab app/pages/posts/[id].vue
   ```ts
   definePageMeta({
     validate: (route) => /^\d+$/.test(route.params.id as string),
   })
   ```
   :::
::::

## 常见错误

### 错误 1：动态参数未校验

`/posts/abc` 会进入页面并导致请求异常。  
修正：使用 `definePageMeta({ validate })` 校验参数。

### 错误 2：用 `a` 标签替代 `NuxtLink`

直接使用 `<a>` 会导致整页刷新。  
修正：站内跳转使用 `NuxtLink`。

### 错误 3：在异步后再调用 `useRoute`

在 `await` 之后再调用 `useRoute()` 可能丢失上下文。  
修正：先 `const route = useRoute()`，再进行异步逻辑。
