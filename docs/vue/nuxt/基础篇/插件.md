---
title: 插件
createTime: 2026/01/29 23:09:11
permalink: /vue/us14yoln/
---

Nuxt 的插件用于在 Vue 应用实例创建时注册 Vue 插件或其他功能，Nuxt 会自动读取 `~/plugins` 目录下的文件，以便将其应用

> [!NOTE]
> 可以使用 `.client` 或 `.server` 来区控制插件的运行环境

## 插件的注册

只有在顶层创建的文件才会被 `Nuxt` 自动识别并注册，对于嵌套文件下的插件，需要额外在 `nuxt.config` 中进行显示声明

::: file-tree

- plugins
  - foo.ts  自动识别并注册
  - bar
    - baz.ts 需要手动在 nuxt config 中注册
    - foz.ts
    - index.ts 可以被识别注册，但不建议
:::

:::code-tabs
@tab nuxt.config.ts
```ts
export default defineNuxtConfig({
  plugins: [
    '~/plugins/bar/baz'
    '~/plugins/bar/foz'
  ]
})
```
:::

## 插件的创建

创建一个插件需要使用 `defineNuxtPlugin` 方法。有两种书写方式: 一种是接受一个回调函数作为参数，且该回调函数会接收唯一的参数 `nuxtApp`，另一种是使用类似选项式 API 的形式

:::code-tabs
@tab 回调函数
```ts
export default defineNuxtPlugin((nuxtApp) => {
  const hello = (msg: string) => `Hello ${msg}!`

  return {
    provide: {
      hello
    }
  }
})
```

@tab 选项式
```ts
export default defineNuxtPlugin({
  name: 'hello',
  setup() {
    return {
      provide: {
        hello: (msg: string) => `Hello ${msg}!`
      }
    }
  }
})
```
:::


:::details nuxtApp
`nuxtApp` 是当前 Nuxt 应用实例的运行时上下文，提供了以下常用属性与方法
- `nuxtApp.vueApp`: Vue 应用实例，可用于注册全局组件、指令等
- `nuxtApp.ssrContext`: 混在服务端存在，包含 SSR 相关信息
- `nuxtApp.provide(name, value)`: 手动注入全局属性，等同于返回 provide 对象
- `nuxtApp.hook/nuxtApp.callHook`: 注册或触发 Nuxt 钩子
:::

> [TIP]
> 可以通过在文件名前加上 "按字母顺序" 编号来控制插件的注册顺序

介绍选项式中 enforce 做什么的

如何在回调形式和选项式定义 hooks 等内容

介绍有 dependsOn 依赖的插件的用法

### 定义插件类型

### 加载策略

主要针对选项式式写法 parallel 


## 插件的使用 

在组件中使用插件通过调用 `useNuxtApp` 函数，所有定义的插件都可以通过 `$xxx` 的形式进行解构

```vue
<script setup lang="ts">
const { $hello } = useNuxtApp()
</script>

<template>
  <div>
    {{ $hello('world') }}
  </div>
</template>

```

## 集成 Vue 插件和指令

通过 `nuxtApp` 参数中的 `vueApp` 就可以集成三方的插件或指令等
