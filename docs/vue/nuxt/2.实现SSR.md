---
title: 实现 SSR
createTime: 2026/01/21 16:29:28
permalink: /vue/ts199xd9/
---

在 Vue 中创建 SSR 应用需要调用 `createSSRApp`，该函数会在激活模式（触发了注入的 script）下挂载应用

服务端用 `@vue/server-renderer` 中的 `renderToString` 来进行渲染

::::steps

1. 实现 Node 热更新

   安装依赖

   ```bash
   pnpm add express
   pnpm add nodemon -D
   pnpm add pino-pretty pino -D
   pnpm add webpack webpack-cli webpack-node-externals -D
   ```

   相关代码
   :::code-tabs
   @tab webpack.config.js

   ```js
   const { resolve } = require('path');
   const nodeExternals = require('webpack-node-externals');

   /** @type {import('webpack').Configuration} */
   module.exports = {
     target: 'node',
     mode: 'development',
     entry: './src/index.js',
     output: {
       filename: 'server_bundle.js',
       path: resolve(__dirname, './dist'),
     },
     externals: [nodeExternals()],
   };
   ```

   @tab package.json

   ```json
   {
     "type": "commonjs",
     "scripts": {
       "dev": "nodemon src/index.js | pino-pretty",
       "build": "webpack --watch",
       "preview": "nodemon ./dist/server_bundle.js | pino-pretty"
     },
     "dependencies": {
       "express": "^5.2.1",
       "pino": "^10.2.1"
     },
     "devDependencies": {
       "nodemon": "^3.1.11",
       "pino-pretty": "^13.1.3",
       "webpack": "^5.104.1",
       "webpack-cli": "^6.0.1",
       "webpack-node-externals": "^3.0.0"
     }
   }
   ```

   :::

2. 实现 renderToString

   安装 Vue 相关依赖

   ```bash
   pnpm add @vue/server-renderer
   pnpm add webpack-merge -D
   pnpm add vue vue-loader babel-loader @babel/preset-env -D
   ```

   创建一个文件夹用于存放 Vue 相关的代码

   :::code-tabs
   @tab main.js

   ```js
   import { createSSRApp } from 'vue';
   import App from './App.vue';

   export function createApp() {
     const app = createSSRApp(App);
     return { app };
   }
   ```

   @tab App.vue

   ```vue
   <template>
     <div>
       <h2>Vue</h2>
       <div>{{ counter }}</div>
       <button @click="plus"></button>
     </div>
   </template>

   <script setup>
   import { ref } from 'vue';

   const counter = ref(0);

   const plus = () => {
     counter.value++;
   };
   </script>
   ```

   :::

   > [!IMPORTANT]
   > 用一个函数来创建 SSRApp 可以避免夸请求状态交叉，每次请求都是一个单独的实例

   后续就可以在 Node 端获取到抛出的 `app` 实例

::::
