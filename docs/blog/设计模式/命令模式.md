---
title: 命令模式
tags:
  - 设计模式
createTime: 2026/02/27 15:50:28
permalink: /blog/jeblkwug/
---

命令模式把“请求”封装成对象，从而支持请求排队、撤销、重做、日志记录。

## 解决的问题

调用者不应该关心“如何做”，只关心“执行哪个命令”，并支持历史回退。

## 结构组成

:::table full-width

| 角色 | 作用 |
| --- | --- |
| Command | 命令接口（执行/撤销） |
| ConcreteCommand | 具体命令实现 |
| Receiver | 真正执行动作的对象 |
| Invoker | 命令调度者 |

:::

## 示例

```ts
class Editor {
  private text = ''
  append(content: string) {
    this.text += content
  }
  removeLast(length: number) {
    this.text = this.text.slice(0, -length)
  }
  getText() {
    return this.text
  }
}

interface Command {
  execute(): void
  undo(): void
}

class AppendTextCommand implements Command {
  constructor(private editor: Editor, private content: string) {}
  execute() {
    this.editor.append(this.content)
  }
  undo() {
    this.editor.removeLast(this.content.length)
  }
}

class CommandManager {
  private history: Command[] = []

  run(command: Command) {
    command.execute()
    this.history.push(command)
  }

  undo() {
    const command = this.history.pop()
    command?.undo()
  }
}

const editor = new Editor()
const manager = new CommandManager()

manager.run(new AppendTextCommand(editor, 'Hello '))
manager.run(new AppendTextCommand(editor, 'World'))
console.log(editor.getText()) // Hello World

manager.undo()
console.log(editor.getText()) // Hello
```

## 适用场景

- 编辑器撤销/重做
- 操作日志回放
- 任务队列与调度

