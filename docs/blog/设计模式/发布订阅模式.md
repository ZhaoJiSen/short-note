---
title: 发布订阅模式
tags:
  - 设计模式
createTime: 2026/02/27 15:50:02
permalink: /blog/g6px47u4/
---

发布订阅模式通过事件中心解耦发布者和订阅者，发布者不关心谁在消费事件。

## 解决的问题

模块间直接调用会形成网状依赖，变更一个模块会影响多个调用链。

## 结构组成

:::table full-width

| 角色 | 作用 |
| --- | --- |
| Publisher | 发布事件 |
| Subscriber | 订阅并处理事件 |
| EventBus / Broker | 事件分发中心 |

:::

## 示例

```ts
type Handler<T = unknown> = (payload: T) => void

class EventBus {
  private events = new Map<string, Set<Handler>>()

  on<T>(event: string, handler: Handler<T>) {
    if (!this.events.has(event)) {
      this.events.set(event, new Set())
    }
    this.events.get(event)!.add(handler as Handler)
  }

  off<T>(event: string, handler: Handler<T>) {
    this.events.get(event)?.delete(handler as Handler)
  }

  emit<T>(event: string, payload: T) {
    this.events.get(event)?.forEach(handler => handler(payload))
  }
}

const bus = new EventBus()

const onOrderPaid = (payload: { orderId: string }) => {
  console.log('发送支付成功通知:', payload.orderId)
}

bus.on('order:paid', onOrderPaid)
bus.emit('order:paid', { orderId: 'O-1001' })
bus.off('order:paid', onOrderPaid)
```

## 适用场景

- 页面组件通信
- 埋点、通知、异步任务分发
- 解耦业务流程步骤

