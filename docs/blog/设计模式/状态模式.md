---
title: 状态模式
tags:
  - 设计模式
createTime: 2026/02/27 15:49:50
permalink: /blog/s6go2ku1/
---

状态模式把“状态相关行为”封装进状态对象，让对象在状态切换时行为自动变化。

## 解决的问题

当业务状态多且转移复杂时，`switch/case` 会迅速失控，难以维护和扩展。

## 结构组成

:::table full-width

| 角色 | 作用 |
| --- | --- |
| State | 状态接口 |
| ConcreteState | 各状态行为实现 |
| Context | 持有当前状态并负责切换 |

:::

## 示例

```ts
interface OrderState {
  pay(ctx: OrderContext): void
  ship(ctx: OrderContext): void
  name: string
}

class PendingState implements OrderState {
  name = 'pending'
  pay(ctx: OrderContext) {
    ctx.setState(new PaidState())
  }
  ship() {
    throw new Error('待支付订单不能发货')
  }
}

class PaidState implements OrderState {
  name = 'paid'
  pay() {
    throw new Error('订单已支付')
  }
  ship(ctx: OrderContext) {
    ctx.setState(new ShippedState())
  }
}

class ShippedState implements OrderState {
  name = 'shipped'
  pay() {
    throw new Error('订单已发货，不能支付')
  }
  ship() {
    throw new Error('订单已发货')
  }
}

class OrderContext {
  constructor(private state: OrderState = new PendingState()) {}
  setState(state: OrderState) {
    this.state = state
    console.log('状态切换为:', state.name)
  }
  pay() {
    this.state.pay(this)
  }
  ship() {
    this.state.ship(this)
  }
}

const order = new OrderContext()
order.pay()
order.ship()
```

## 适用场景

- 订单、工单、审批流等明确状态机场景
- 不同状态下行为差异明显

