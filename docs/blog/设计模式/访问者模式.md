---
title: 访问者模式
tags:
  - 设计模式
createTime: 2026/02/27 15:50:51
permalink: /blog/1dudopbg/
---

访问者模式把“数据结构”和“作用于数据结构的操作”分离，便于新增操作而不改元素类。

## 解决的问题

当对象结构稳定、操作经常变化时，把操作写进元素类会导致类不断膨胀。

## 结构组成

:::table full-width

| 角色 | 作用 |
| --- | --- |
| Element | 元素接口，提供 `accept` |
| ConcreteElement | 具体元素 |
| Visitor | 访问者接口 |
| ConcreteVisitor | 具体操作实现 |

:::

## 示例

```ts
interface Visitor {
  visitNumber(node: NumberNode): number
  visitAdd(node: AddNode): number
}

interface Node {
  accept(visitor: Visitor): number
}

class NumberNode implements Node {
  constructor(public value: number) {}
  accept(visitor: Visitor) {
    return visitor.visitNumber(this)
  }
}

class AddNode implements Node {
  constructor(public left: Node, public right: Node) {}
  accept(visitor: Visitor) {
    return visitor.visitAdd(this)
  }
}

class EvalVisitor implements Visitor {
  visitNumber(node: NumberNode) {
    return node.value
  }
  visitAdd(node: AddNode) {
    return node.left.accept(this) + node.right.accept(this)
  }
}

const ast = new AddNode(new NumberNode(10), new AddNode(new NumberNode(2), new NumberNode(3)))
const result = ast.accept(new EvalVisitor())
console.log(result) // 15
```

## 适用场景

- AST 分析与编译器
- 报表导出（同一结构，多种输出）
- 规则树计算

