---
title: 代理模式
tags:
  - 设计模式
createTime: 2026/02/27 15:49:24
permalink: /blog/4lqeb7pz/
---

代理模式通过代理对象控制对真实对象的访问，可以加上权限、缓存、延迟加载等能力。

## 解决的问题

有些对象访问成本高或需要额外控制（权限、限流、日志）时，不希望改动真实对象本身。

## 结构组成

:::table full-width

| 角色 | 作用 |
| --- | --- |
| Subject | 抽象接口 |
| RealSubject | 真实对象 |
| Proxy | 代理对象，控制访问 |

:::

## 示例

```ts
interface UserService {
  getUser(id: number): Promise<{ id: number; name: string }>
}

class RealUserService implements UserService {
  async getUser(id: number) {
    console.log('请求后端接口...')
    return { id, name: `user-${id}` }
  }
}

class CacheProxyUserService implements UserService {
  private cache = new Map<number, { id: number; name: string }>()
  constructor(private target: UserService) {}

  async getUser(id: number) {
    if (this.cache.has(id)) {
      console.log('命中缓存')
      return this.cache.get(id)!
    }
    const user = await this.target.getUser(id)
    this.cache.set(id, user)
    return user
  }
}

const userService = new CacheProxyUserService(new RealUserService())
await userService.getUser(1)
await userService.getUser(1)
```

## 适用场景

- API 缓存代理
- 访问控制代理
- 懒加载代理

