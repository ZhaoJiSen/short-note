---
title: 浏览器的进程模型
createTime: 2025/07/10 15:27:59
permalink: /browser/0pkbd4hl/
---

## 1. 进程与线程

**进程**就是在启动一个程序时，操作系统==为该程序创建的一块用来存放代码、运行中的数据和一个执行任务的主线程的内存运行环境==。而**线程**是操作系统能够进行运算调度的最小单位。==它被包含在进程之中，是进程中的实际运作单位==。

> [!IMPORTANT]
> 线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率

::: details 进程与线程之间的关系特点 
1. 进程中的任意一线程执行出错，都会导致整个进程的崩溃。
2. 线程之间共享进程中的数据。
3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。
4. 进程之间的内容相互隔离。
:::

## 2. 单进程浏览器

早在 2007 年之前，市面上的浏览器都是单进程的。所谓单进程浏览器是指浏览器的所有功能模块都是运行在统一同一个进程里，这些模块包含了：网络、插件、JavaScript 运行环境、渲染引擎和页面等。

<ImageCard image="https://static001.geekbang.org/resource/image/6d/ca/6ddad2419b049b0eb2a8036f3dfff1ca.png" href="/" />

让如此多的模块运行在一个环境中，是导致单进程浏览器**不稳定**、**不流畅**和**不安全**的一个主要原因。

::: steps

1. 不稳定

   早期浏览器通过借助插件来实现诸如 Web 视频、游戏等复杂功能，同时也是最容易引发问题的模块，就会导致一个插件的崩溃使得整个浏览器的崩溃。其次渲染引擎模块也是不稳定的，一些复杂的 JavaScript 代码就有可能引起渲染引擎模块的崩溃，进而导致整个浏览器的崩溃。

2. 不流畅

   由于在单进程架构的浏览器中所有的模块全部运行在同一个进程中，也就意味着在同一时刻只有一个模块可以运行，如果此时运行了一个无限循环的脚本，那么它将会会独占整个线程，其他运行在该线程中的模块就没有机会被执行

3. 不安全

   插件可以使用 C/C++ 等代码编写，通过插件可以获取到操作系统的任意资源，当页面运行一个插件时也就意味着这个插件能完全操作你的电脑。如果是个恶意插件，那么它就可以释放病毒、窃取你的账号密码，引发安全性问题

:::

## 3. 多进程浏览器

在 2008 年 Chrome 发布时，就采用了多进程的架构，其将浏览器中的各个功能模块拆分出来，分别运行在不同的进程中

<ImageCard image="https://static001.geekbang.org/resource/image/cd/60/cdc9215e6c6377fc965b7fac8c3ec960.png" href="/" />

多进程浏览器通过充分利用进程与线程之间的关系从而解决了单进程浏览器中存在的稳定性、流畅性和安全性问题。

::: steps

1. 解决不稳定性

   由于进程是相互隔离的，所以当一个页面或者插件崩溃时，影响到的仅仅是当前的页面进程或者插件进程，并不会影响到浏览器和其他页面

2. 解决不流畅

   同样，JavaScript 也是运行在渲染进程中的，所以即使 JavaScript 阻塞了渲染进程，影响到的也只是当前的渲染页面，而并不会影响浏览器和其他页面，因为其他页面的脚本是运行在它们自己的渲染进程中的

3. 解决不安全性

   采用多进程架构的额外好处是可以使用安全沙箱，沙箱里面的程序可以运行，但是不能在硬盘上写入任何数据，也不能在敏感位置读取任何数据，==Chrome 把插件进程和渲染进程锁在沙箱里面==，这样即使在渲染进程或者插件进程里面执行了恶意程序，恶意程序也无法突破沙箱去获取系统权限。

:::

## 4. 现代多进程架构

时代是发展的，技术是进步的。相较之前，目前的多进程架构又有了很多新的变化

<ImageCard image="https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png" href="/" />

最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。

::: details 其功能分别为：
- **浏览器主进程**：负责界面显示、用户交互、子进程管理，同时提供存储等功能
- **渲染进程**：将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- **GPU 进程**：GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求
- **网络进程**：负责页面的网络资源加载
- 插件进程：负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响
:::
