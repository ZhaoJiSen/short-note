---
title: 跨站脚本攻击 XSS
createTime: 2026/02/26 12:51:29
permalink: /browser/he21jt3t/
---

XSS（Cross-Site Scripting）本质是：
攻击者让浏览器执行了“本不该执行”的脚本。

![XSS 导图](/browser/source-images/1710984211726-b5c2e213-4e5a-4844-bd9e-a89300b26f84.jpeg)

## XSS 能做什么

一旦注入脚本运行，常见后果有：

1. 读取或间接滥用用户身份信息。  
2. 监听输入行为（键盘记录、表单劫持）。  
3. 篡改页面 DOM（伪造登录框、钓鱼按钮）。

## 三种典型形态

### 1. 存储型 XSS

恶意脚本被写入数据库，后续页面渲染时“稳定触发”。

![存储型 XSS](/browser/source-images/1710993477214-6a6865a9-7cd9-4a3c-833b-cb90cae0f015.png)

### 2. 反射型 XSS

恶意载荷在请求参数中，服务端直接拼回页面，通常通过诱导链接触发。

![反射型 XSS](/browser/source-images/1710998600192-a8ff57fc-c5f6-4d9c-8837-0276765088b4.png)

### 3. DOM 型 XSS

不一定经过服务端，前端直接把不可信数据写入危险 DOM 接口（如 `innerHTML`）导致执行。

## 防护基线

### 输入处理：校验 + 输出编码

任何不可信数据在进入 HTML/JS/URL 上下文前都应做上下文相关编码。

```js
function escapeHtml(text) {
  return text
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#39;')
}
```

### 开启 CSP（强烈推荐）

通过 CSP 限制脚本来源和执行方式，减少注入脚本可执行面。

```http
Content-Security-Policy: default-src 'self'; script-src 'self' 'nonce-<random>'
```

### Cookie 加 `HttpOnly`

即使发生 XSS，也能减少脚本直接读取 Cookie 的风险。

![HttpOnly 示例](/browser/source-images/1710999494325-01860de3-cd9b-4f04-a26b-6d75da0df7c6.png)

## 一条工程化建议

把“禁止直接使用危险 API（`innerHTML`、`document.write`）”写入 lint 规则和代码评审清单，比只靠口头提醒有效得多。
