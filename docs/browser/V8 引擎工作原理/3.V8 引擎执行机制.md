---
title: V8 引擎执行机制
createTime: 2026/02/26 12:50:24
permalink: /browser/ko9zfu7j/
---

V8 不是“纯解释器”也不是“纯编译器”，而是解释执行和 JIT 优化结合。

![V8 导图](/browser/source-images/1710905216772-b93173b7-e536-4fe4-a782-5b1d3358ad67.jpeg)

## 编译型与解释型的差异

:::table
| 模式 | 特点 | 优势 | 代价 |
| --- | --- | --- | --- |
| 编译型 | 先编译成机器码再运行 | 运行快 | 编译耗时、产物占空间 |
| 解释型 | 运行时逐条解释 | 启动快、灵活 | 热路径效率低 |
:::

V8 的策略是：启动先快（解释），热点再提速（JIT）。

## 执行链路：源码 -> AST -> 字节码 -> 机器码

![V8 执行流程](/browser/source-images/1710906476145-d8c16797-9588-447b-83bd-3806e3eb245a.png)

### 1) 词法分析（Tokenize）

源代码先被拆成 Token。

![Token 示例](/browser/source-images/1710907154660-74acf8f3-eb72-4feb-bdbe-4554e0393699.png)

### 2) 语法分析（Parse）

Token 按语法规则生成 AST。

![AST 示例](/browser/source-images/1710906859569-aced18f1-0e62-47e5-b871-bbd8f7abd5d4.png)

### 3) 生成字节码（Ignition）

AST 交给解释器 `Ignition`，先生成并执行字节码。

![字节码与机器码体积对比](/browser/source-images/1710911907842-71f96574-069b-4799-8a95-b26aae1bfbc2.png)

## 热点代码优化（TurboFan）

执行过程中，V8 会收集运行反馈。
当某段代码变成热点，`TurboFan` 会把它编译成机器码以提高后续性能。

![JIT 热点优化](/browser/source-images/1710912584039-c3f678d5-9bbe-4fd2-a3e7-27825bb1ec1d.png)

:::details 为什么有时会“反优化”
如果运行时类型信息和优化假设不一致（例如隐藏类变化过大），V8 会回退到更保守路径，这就是反优化（deopt）。
:::

## 一个容易踩的性能坑

同一函数里长期混用不稳定类型，会降低优化命中率：

```js
function add(a, b) {
  return a + b
}

add(1, 2)
add(3, 4)
add('x', 1) // 类型形态变化，可能影响优化路径
```

当你追求稳定性能时，保持热路径数据形态稳定非常重要。
