---
title: 导航流程
createTime: 2025/07/10 15:28:35
permalink: /browser/avqghghu/
---

所谓“导航”，不是简单的一次网络请求。
它是从用户输入，到浏览器主进程、网络进程、渲染进程协作，再到页面提交与可交互的一整条链路。

## 从输入 URL 开始发生了什么

:::steps
1. 地址栏输入后，浏览器先判断这是 `URL` 还是搜索词。  
2. 回车后触发导航准备：当前页面可收到 `beforeunload`。  
3. Browser 进程把目标地址通过 `IPC` 发给 Network 进程。  
4. Network 进程做缓存检查、DNS、建连、发请求、收响应。  
5. 若响应可被渲染（如 `text/html`），进入“提交文档”阶段。  
6. Render 进程确认提交后，页面开始解析与渲染。
:::

![开始加载状态](/browser/source-images/1710593000704-ed6683eb-8629-4425-ae22-a4567916f25c.png)

## 响应头如何决定后续命运

浏览器不是拿到响应体就立即渲染，它会先看响应头。

### 重定向（301/302/307/308）

当响应码提示重定向时，浏览器读取 `Location`，重新发起导航。

![301 重定向](/browser/source-images/1710595054787-422f4a84-d356-4b33-b635-0b4472d76b15.png)

### 内容类型分流

`Content-Type` 会决定“渲染”还是“下载”。

![HTML 类型](/browser/source-images/1710595539255-f9beaab5-ba6f-490d-8bdf-63c8de2b1444.png)

![字节流下载类型](/browser/source-images/1710595634847-fadf76c7-9ba4-420b-bc76-2fe999e3c856.png)

:::details 典型分流规则
1. `text/html`：继续导航，准备渲染进程。  
2. `application/octet-stream`：通常交给下载管理器，导航流程结束。  
3. 错误的 `Content-Type` 会导致“本应展示却下载”或“本应下载却尝试渲染”。
:::

## 为什么地址栏更新会慢半拍

你会看到一个典型现象：回车后页面还停在旧内容，过一小会才切换。
这是因为浏览器在等“提交文档”完成。

![提交文档流程图](/browser/source-images/1710596741523-2030cf64-7046-4a43-ba8f-9c0d3ef6e3b9.png)

提交文档关键点：

1. Browser 进程先发起“提交文档”消息。  
2. Render 进程与 Network 进程建立数据管道。  
3. Render 确认提交后，Browser 才更新地址栏、安全状态、历史栈和页面。

![导航完成状态](/browser/source-images/1710596889611-691e3190-6e3a-4381-b3e8-88f818f5802d.png)

## 复用渲染进程的影响

同站点导航时，Chrome 可能复用已有渲染进程，而不是新建。
这会降低切换成本，但也意味着“同进程共享命运”。

![同站点复用渲染进程](/browser/source-images/1710596175327-427040dd-ae99-4814-986e-296d35bbf98a.png)

## 和 CSR 的关系

导航只负责“把文档送到渲染进程并启动渲染”。
如果页面是 `CSR` 应用，首屏真正内容往往要等前端脚本加载并执行后才出现。

换句话说：

- 导航完成不等于业务内容可见。  
- CSR 首屏体验高度依赖 JS 下载、解析、执行与接口返回速度。
