---
title: 渲染流程
createTime: 2025/07/10 15:28:40
permalink: /browser/m396ohn4/
---

导航提交文档后，渲染进程才真正开始“把代码变成像素”。
这个过程常被称为渲染流水线（Rendering Pipeline）。

![渲染流程总览](/browser/source-images/1710644833562-9f02f1ab-1c31-4388-afd9-b89bcbb4f9a5.png)

## 渲染流水线的关键阶段

![渲染流水线](/browser/source-images/1710644968978-396c4ddb-21ab-45a7-ac0e-d10570bc9861.png)

:::table
| 阶段 | 输入 | 输出 |
| --- | --- | --- |
| DOM 构建 | HTML | DOM Tree |
| 样式计算 | CSS + DOM | Computed Style |
| 布局（Layout） | DOM + Style | Layout Tree（几何信息） |
| 分层（Layer） | Layout Tree | Layer Tree |
| 绘制（Paint） | Layer Tree | Display List |
| 光栅化（Raster） | Display List | 位图 Tiles |
| 合成（Composite） | 位图 Tiles | 最终帧 |
:::

## 1) 构建 DOM 树

浏览器先把 HTML 文本解析成结构化树，后续样式和布局都依赖它。

![DOM 构建](/browser/source-images/1710645468982-2ead008d-567d-479c-a1f3-735e2ae660d4.png)

## 2) 样式计算

样式计算不是“直接套 CSS”，内部会经历三步：

1. CSS 文本转可计算结构。  
2. 属性值标准化（如 `2em` -> 计算值）。  
3. 继承与层叠后得出每个节点的最终样式。

![styleSheets 结构](/browser/source-images/1710646030403-3925e99d-038a-447b-be11-68061c94b2ea.png)

![样式标准化](/browser/source-images/1710646548159-66b4c900-faf8-4c40-9f5d-f274bda2675a.png)

## 3) 布局（Layout）

布局会计算可见元素的几何信息（位置、宽高）。
`display: none` 的节点不会进入布局树。

![布局树](/browser/source-images/1710648239518-b0857345-016b-4e8b-866b-2e7f46237888.png)

## 4) 分层与绘制

不是每个节点都会成为独立图层，常见触发条件包括：

1. 层叠上下文（如 `transform`、`opacity`、特定定位）。  
2. 裁剪（clip）和滚动容器。  
3. 合成优化策略命中。

![布局树到图层树](/browser/source-images/1710726250803-fbbfa5d5-bd8d-4aa6-9b01-07229f072202.png)

![绘制列表](/browser/source-images/1710727359790-daa04a0b-389a-4a8f-9523-c3548d65a875.png)

## 5) 光栅化与合成

主线程生成绘制列表后，合成线程会把图层切成 tiles 并优先处理视口附近区域。
多数场景会交给 GPU 光栅化，最后再合成输出到屏幕。

![主线程与合成线程](/browser/source-images/1710727564476-d035b126-45e1-4897-8341-f78f0ac7c066.png)

![图块与视口](/browser/source-images/1710727798015-910cdc98-6479-4c43-9a69-33555b16d591.png)

![GPU 光栅化](/browser/source-images/1710727996767-60be0767-fd41-4de1-8e5e-4e94af97cfc6.png)

## CSR 与渲染链路

`CSR` 页面首屏通常会多出一段“等待 JS”的链路：

1. 下载 JS bundle。  
2. 解析与执行框架运行时。  
3. 拉取接口数据。  
4. 才真正生成主要业务 DOM。

所以在 CSR 场景下，优化首屏通常要同时抓三件事：

- 减少 JS 体积。  
- 降低主线程长任务。  
- 提前关键数据与关键 CSS。
